<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Legacy - Encrypt</title>
        <link rel="stylesheet" href="styles.css" />
        <style>
            header {
                background-image: url("legacy-background.png"); /* Replace with your image URL */
                background-position: center;
                background-repeat: no-repeat;
                background-size: cover;
                justify-content: center;
                align-items: center;
                color: white; /* Text color */
            }
            input,
            textarea {
                width: calc(100% - 20px);
                margin: 10px;
                padding: 10px;
            }

            h2 {
                margin: 30px;
            }
            p {
                margin-top: 0px;
            }
            section {
                width: 80%;
                margin: auto;
            }
            button {
                padding: 10px 15px;
                background-color: #f7931a; /* Bitcoin orange */
                color: white; /* Text color */
                border: none; /* Remove default border */
                cursor: pointer; /* Change cursor to pointer on hover */
                border-radius: 5px; /* Optional: rounded corners */
                display: block;
                margin: auto;
                margin-bottom: 30px;
            }

            button:hover {
                background-color: #d6811a; /* Darker shade on hover for better UX */
            }

            .container {
                background-image: url("background.png");
                background-position: center;
                background-repeat: no-repeat;
                background-size: cover;
                justify-content: center;
                align-items: center;
                width: 100%;
                margin: auto;
                color: white;
                padding-top: 30px;
                padding-bottom: 30px;
            }
            .input-container {
                position: relative; /* Make this container relative for absolute positioning of the icon */
            }
            .toggle-visibility {
                position: absolute; /* Position the icon absolutely */
                right: 10px; /* Space from the right edge of the input field */
                top: 50%; /* Center vertically */
                transform: translateY(-50%); /* Adjust for vertical centering */
                cursor: pointer; /* Change cursor to pointer for the icon */
                display: flex; /* Use flexbox for alignment */
                align-items: center; /* Center items vertically */
            }
            .eyelid {
                display: inline-block;
                font-size: 24px;
                transform: rotate(90deg); /* Rotate eyelids to be horizontal */
                color: black;
            }

            .top {
                position: absolute;
                top: -18px;
                left: -20px;
            }

            .bottom {
                position: absolute;
                top: -11px;
                left: -20px;
            }

            .iris {
                display: inline-block;
                font-size: 16px; /* Size of the iris (0) */
                line-height: 0; /* Center vertically with eyelids */
                margin-left: -23px; /* Adjust positioning as needed */
                margin-right: -4px; /* Adjust positioning as needed */
                color: black;
            }

            .logo {
                position: absolute;
                top: 20px; /* Adjust as needed for vertical spacing */
                right: 10px; /* Adjust as needed for horizontal spacing */
                width: auto;
                height: 250px; /* Set desired height for your logo */
            }

            a {
                color: #007bff;
                text-decoration: none;
            }

            ul li {
                margin-top: 10px;
            }
        </style>
    </head>
    <body>
        <header>
            <nav id="navbar" class="navbar">
                <div class="navbar-toggle" id="navbar-toggle">
                    &#9776;
                    <!-- Hamburger icon -->
                </div>
                <ul class="navbar-menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="mission.html">Mission</a></li>
                    <li><a href="how-it-works.html">How It Works</a></li>
                    <li><a href="benefits.html">Benefits</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
            <div style="height: 70vh"></div>
            <h1>Legacy</h1>
            <div style="height: 5vh"></div>
            <h3>2-Key Bitcoin Seed Phrase Encryption</h3>
            <div style="height: 5vh"></div>
        </header>
        <div class="container">
            <h2>Instructions</h2>
            <section style="align-items: center; justify-content: center">
                <ul>
                    <li>
                        Please read the
                        <a href="how-it-works.html">HOW-IT-WORKS</a> page and
                        the <a href="benefits.html">BENEFITS</a> page before
                        using this
                    </li>
                    <li>
                        This online version is for demonstration purposes only.
                        DO NOT ENTER YOUR ACTUAL SEED PHRASE INTO THIS
                        DEMONSTRATION.
                    </li>
                    <li>
                        Please check the expected functionality of your keys
                        using the
                        <a href="Legacy-decrypt.html">DECRYPT</a> page.
                    </li>
                </ul>
            </section>
        </div>
        <div class="container">
            <section>
                <label for="key1">Benefactor Key:</label>
                <div class="input-container">
                    <input
                        type="password"
                        id="key1"
                        placeholder="benefactorkey"
                        required
                    />
                    <span
                        class="toggle-visibility"
                        onclick="toggleVisibility('key1', this)"
                    >
                        <span
                            class="eyelid top"
                            style="transform: rotate(90deg)"
                            >(</span
                        >
                        <!-- Top eyelid -->
                        <span class="iris">0</span>
                        <!-- Iris -->
                        <span
                            class="eyelid bottom"
                            style="transform: rotate(90deg)"
                            >)</span
                        >
                        <!-- Bottom eyelid -->
                    </span>
                </div>

                <label for="key1Confirm">Confirm Benefactor Key:</label>
                <div class="input-container">
                    <input
                        type="password"
                        id="key1Confirm"
                        placeholder="Confirm Benefactor key here"
                        required
                    />
                    <span
                        class="toggle-visibility"
                        onclick="toggleVisibility('key1Confirm', this)"
                    >
                        <span class="eyelid top">(</span>
                        <!-- Top eyelid -->
                        <span class="iris">0</span>
                        <!-- Iris -->
                        <span class="eyelid bottom">)</span>
                        <!-- Bottom eyelid -->
                        <!-- Open eye icon -->
                        <span class="eye-closed" style="display: none">)</span>
                        <!-- Closed eye icon -->
                    </span>
                </div>

                <label for="key2">Beneficiary Key:</label>
                <input
                    type="text"
                    id="key2"
                    placeholder="beneficiarykey"
                    required
                />

                <label for="key2Confirm">Confirm Beneficiary Key:</label>
                <input
                    type="text"
                    id="key2Confirm"
                    placeholder="Confirm Beneficiary key here"
                    required
                />

                <label for="plaintext">Seed Phrase:</label>
                <textarea
                    id="plaintext"
                    rows="2"
                    placeholder="seedphrase"
                    required
                ></textarea>

                <label for="plaintextConfirm">Confirm Seed Phrase:</label>
                <textarea
                    id="plaintextConfirm"
                    rows="2"
                    placeholder="Confirm your Seed Phrase here"
                    required
                ></textarea>
                <button onclick="encryptMessage()">Encrypt</button>
                <h3>Encrypted Seed Phrase:</h3>
                <p id="ciphertext"></p>
            </section>

            <div style="height: 10vh"></div>
            <footer>
                Legacy - Encryption and Consulting. All Rights Reserved 2025.
            </footer>
        </div>
        <script>
            const toggle = document.getElementById("navbar-toggle");
            const menu = document.querySelector(".navbar-menu");

            toggle.addEventListener("click", function () {
                menu.classList.toggle("active"); // Toggle the 'active' class
            });
        </script>

        <script>
            // Function to compute SHA-256 hash
            async function sha256(message) {
                const encoder = new TextEncoder();
                const data = encoder.encode(message);
                const hashBuffer = await crypto.subtle.digest("SHA-256", data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                return hashArray
                    .map((b) => ("00" + b.toString(16)).slice(-2))
                    .join("");
            }

            // Function to convert hash to alphabetic key (only letters)
            function getAlphabeticKey(hash) {
                return hash
                    .split("")
                    .map((char) =>
                        String.fromCharCode(
                            (parseInt(char, 16) % 26) + "a".charCodeAt(0),
                        ),
                    )
                    .join("");
            }

            function validateInput(input) {
                const regex = /^[a-z]+$/; // Only lowercase letters
                return regex.test(input);
            }

            async function encryptMessage() {
                const key1 = document.getElementById("key1").value.trim();
                const key1Confirm = document
                    .getElementById("key1Confirm")
                    .value.trim();
                const key2 = document.getElementById("key2").value.trim();
                const key2Confirm = document
                    .getElementById("key2Confirm")
                    .value.trim();
                const plaintext = document
                    .getElementById("plaintext")
                    .value.trim();
                const plaintextConfirm = document
                    .getElementById("plaintextConfirm")
                    .value.trim();

                // Validate inputs and check for matches
                if (
                    !validateInput(key1) ||
                    !validateInput(key2) ||
                    !validateInput(plaintext) ||
                    key1 !== key1Confirm ||
                    key2 !== key2Confirm ||
                    plaintext !== plaintextConfirm
                ) {
                    alert(
                        "Please ensure all keys and messages match and contain only lowercase letters without numbers, spaces, special characters or uppercase letters.",
                    );
                    return;
                }

                console.log("User 1 Key:", key1);
                console.log("User 2 Key:", key2);
                console.log("Plaintext Message:", plaintext);

                // Combine keys
                const combinedKey = key1 + key2;

                // Hash the combined key using SHA-256
                const hashedKey = await sha256(combinedKey);

                // Convert hashed key to alphabetic key
                const numberlessHashedKey = getAlphabeticKey(hashedKey);

                // Encrypting logic
                let ciphertext = "";
                let keyIndex = 0;

                for (let i = 0; i < plaintext.length; i++) {
                    let char = plaintext[i];

                    let shift =
                        numberlessHashedKey[
                            keyIndex % numberlessHashedKey.length
                        ].charCodeAt(0) - "a".charCodeAt(0);

                    let charIndex = char.charCodeAt(0) - "a".charCodeAt(0); // Get index of current character
                    let encryptedCharIndex = (charIndex + shift) % 26;

                    if (!isNaN(encryptedCharIndex)) {
                        let encryptedChar = String.fromCharCode(
                            encryptedCharIndex + "a".charCodeAt(0),
                        );
                        ciphertext += encryptedChar; // Concatenate encrypted character
                        keyIndex++; // Move to the next character in the key
                    } else {
                        console.error(
                            `Invalid encryptedCharIndex for character '${char}':`,
                            encryptedCharIndex,
                        );
                    }
                }

                document.getElementById("ciphertext").innerText =
                    ciphertext || "No valid ciphertext generated.";
            }

            function toggleVisibility(inputId, iconElement) {
                const inputField = document.getElementById(inputId);
                const eyelids = iconElement.querySelectorAll(".eyelid");
                const iris = iconElement.querySelectorAll(".iris");

                if (inputField.type === "password") {
                    inputField.type = "text"; // Show password
                    // Change to closed eye representation
                    eyelids[0].style.display = "none"; // Hide top eyelid
                    eyelids[1].style.transform = "rotate(90deg)"; // Keep bottom eyelid horizontal
                    //eyelids[2].innerHTML = ")"; // Change to closed eye representation
                    iris[0].style.display = "none";
                } else {
                    inputField.type = "password"; // Hide password
                    // Change to open eye representation
                    eyelids[0].style.display = "inline"; // Show top eyelid
                    eyelids[1].style.transform = "rotate(90deg)"; // Keep bottom eyelid horizontal
                    //eyelids[2].innerHTML = ")"; // Change back to open eye representation
                    iris[0].style.display = "inline";
                }
            }
        </script>
    </body>
</html>
